const translations = {
    es: {
        "Mapa": "Mapa",
        "Clima": "Clima",
        "Gráfico": "Gráfico",
        "Atributos Visibles": "Atributos Visibles",
        "Atributos Ocultos": "Atributos Ocultos",
        "Temperatura": "Temperatura",
        "Humedad": "Humedad",
        "Viento": "Viento",
        "Presión Atmosférica": "Presión Atmosférica",
        "Tiempo": "Tiempo",
        "Precipitaciones": "Precipitaciones",
        "Actualizando datos": "Actualizando datos...",
        "Última actualización": "Última actualización",
        "No hay balizas seleccionadas": "No hay balizas seleccionadas",
        "Error al cargar los datos": "Error al cargar los datos",
        "No se ha seleccionado información": "No se ha seleccionado información",
        // Estados del tiempo
        "soleado": "soleado",
        "sol": "sol",
        "despejado": "despejado",
        "parcialmente nublado": "parcialmente nublado",
        "nubes dispersas": "nubes dispersas",
        "intervalos nubosos": "intervalos nubosos",
        "nubes": "nubes",
        "nublado": "nublado",
        "muy nuboso": "muy nuboso",
        "cubierto": "cubierto",
        "lluvia": "lluvia",
        "lluvioso": "lluvioso",
        "chubascos": "chubascos",
        "precipitaciones": "precipitaciones",
        "tormenta": "tormenta",
        "tormentoso": "tormentoso",
        "tormenta eléctrica": "tormenta eléctrica",
        "nieve": "nieve",
        "nevado": "nevado",
        "aguanieve": "aguanieve",
        "niebla": "niebla",
        "bruma": "bruma",
        // Unidades
        "°C": "°C",
        "km/h": "km/h",
        "hPa": "hPa",
        "mm": "mm",
        "%": "%",
        // Traducciones para el gráfico (tabs-3)
        'seleccionar-baliza': 'Seleccionar baliza',
        'seleccionar-baliza-placeholder': 'Seleccione una baliza',
        'fecha-inicio': 'Fecha de inicio',
        'fecha-fin': 'Fecha de fin',
        'mostrar-grafico': 'Mostrar Gráfico',
        'temperatura': 'Temperatura',
        'humedad': 'Humedad',
        'temperatura-humedad': 'Temperatura y Humedad',
        'grafico-atributo': 'Histórico de Temperatura y Humedad',
        'fecha': 'Fecha',
        'no-datos': 'No se encontraron datos para el período especificado',
        'error-datos': 'Error al obtener los datos',
        'error-fechas': 'La fecha de inicio debe ser anterior a la fecha de fin',
        'seleccionar-todos': 'Por favor, seleccione todos los campos requeridos',
        // Traducciones para pronósticos
        'pronostico-manana': 'Pronóstico para mañana',
        'error-pronostico': 'Error al obtener el pronóstico del tiempo',
        'error-api-key': 'Error de autenticación: API key inválida',
        'ciudad-no-encontrada': 'Ciudad no encontrada',
        'error-api': 'Error al conectar con el servicio meteorológico',
        'no-datos-disponibles': 'No hay datos disponibles',
        'no-pronostico-manana': 'No se encontró el pronóstico para mañana',
        'pronostico-para': 'Pronóstico para',
        'pronostico-no-disponible': 'Pronóstico no disponible en este momento',
        'baliza-no-encontrada': 'Baliza no encontrada',
        'formato-invalido': 'Formato de datos inválido'
    },
    en: {
        "Mapa": "Map",
        "Clima": "Weather",
        "Gráfico": "Chart",
        "Atributos Visibles": "Visible Attributes",
        "Atributos Ocultos": "Hidden Attributes",
        "Temperatura": "Temperature",
        "Humedad": "Humidity",
        "Viento": "Wind",
        "Presión Atmosférica": "Atmospheric Pressure",
        "Tiempo": "Weather",
        "Precipitaciones": "Precipitation",
        "Actualizando datos": "Updating data...",
        "Última actualización": "Last update",
        "No hay balizas seleccionadas": "No markers selected",
        "Error al cargar los datos": "Error loading data",
        "No se ha seleccionado información": "No information has been selected",
        // Estados del tiempo
        "soleado": "sunny",
        "sol": "sun",
        "despejado": "clear",
        "parcialmente nublado": "partly cloudy",
        "nubes dispersas": "scattered clouds",
        "intervalos nubosos": "cloudy intervals",
        "nubes": "clouds",
        "nublado": "cloudy",
        "muy nuboso": "very cloudy",
        "cubierto": "overcast",
        "lluvia": "rain",
        "lluvioso": "rainy",
        "chubascos": "showers",
        "precipitaciones": "precipitation",
        "tormenta": "storm",
        "tormentoso": "stormy",
        "tormenta eléctrica": "thunderstorm",
        "nieve": "snow",
        "nevado": "snowy",
        "aguanieve": "sleet",
        "niebla": "fog",
        "bruma": "mist",
        // Unidades
        "°C": "°F",
        "km/h": "mph",
        "hPa": "hPa",
        "mm": "in",
        "%": "%",
        // Traducciones para el gráfico (tabs-3)
        'seleccionar-baliza': 'Select beacon',
        'seleccionar-baliza-placeholder': 'Select a marker',
        'fecha-inicio': 'Start date',
        'fecha-fin': 'End date',
        'mostrar-grafico': 'Show Chart',
        'temperatura': 'Temperature',
        'humedad': 'Humidity',
        'temperatura-humedad': 'Temperature and Humidity',
        'grafico-atributo': 'Temperature and Humidity History',
        'fecha': 'Date',
        'no-datos': 'No data found for the specified period',
        'error-datos': 'Error getting data',
        'error-fechas': 'Start date must be before end date',
        'seleccionar-todos': 'Please select all required fields',
        // Traducciones para pronósticos
        'pronostico-manana': 'Tomorrow\'s Forecast',
        'error-pronostico': 'Error getting weather forecast',
        'error-api-key': 'Authentication error: Invalid API key',
        'ciudad-no-encontrada': 'City not found',
        'error-api': 'Error connecting to weather service',
        'no-datos-disponibles': 'No data available',
        'no-pronostico-manana': 'Tomorrow\'s forecast not found',
        'pronostico-para': 'Forecast for',
        'pronostico-no-disponible': 'Forecast not available at this time',
        'baliza-no-encontrada': 'Beacon not found',
        'formato-invalido': 'Invalid data format'
    },
    eu: {
        "Mapa": "Mapa",
        "Clima": "Eguraldia",
        "Gráfico": "Grafikoa",
        "Atributos Visibles": "Atributu Ikusgarriak",
        "Atributos Ocultos": "Ezkutuko Atributuak",
        "Temperatura": "Tenperatura",
        "Humedad": "Hezetasuna",
        "Viento": "Haizea",
        "Presión Atmosférica": "Presio Atmosferikoa",
        "Tiempo": "Eguraldia",
        "Precipitaciones": "Prezipitazioak",
        "Actualizando datos": "Datuak eguneratzen...",
        "Última actualización": "Azken eguneratzea",
        "No hay balizas seleccionadas": "Ez dago baliza hautatuik",
        "Error al cargar los datos": "Errorea datuak kargatzean",
        "No se ha seleccionado información": "Ez da informaziorik hautatu",
        // Estados del tiempo
        "soleado": "eguzkitsua",
        "sol": "eguzkia",
        "despejado": "oskarbi",
        "parcialmente nublado": "partzialki lainotuta",
        "nubes dispersas": "hodei sakabanatuak",
        "intervalos nubosos": "hodei tarteak",
        "nubes": "hodeiak",
        "nublado": "lainotuta",
        "muy nuboso": "oso lainotuta",
        "cubierto": "estalia",
        "lluvia": "euria",
        "lluvioso": "euritsua",
        "chubascos": "zaparradak",
        "precipitaciones": "prezipitazioak",
        "tormenta": "ekaitza",
        "tormentoso": "ekaiztsua",
        "tormenta eléctrica": "trumoi-ekaitza",
        "nieve": "elurra",
        "nevado": "elurtuta",
        "aguanieve": "elur-bustia",
        "niebla": "lainoa",
        "bruma": "gandua",
        // Unidades
        "°C": "°C",
        "km/h": "km/h",
        "hPa": "hPa",
        "mm": "mm",
        "%": "%",
        // Traducciones para el gráfico
        'seleccionar-baliza': 'Baliza aukeratu',
        'seleccionar-baliza-placeholder': 'Aukeratu baliza bat',
        'fecha-inicio': 'Hasiera data',
        'fecha-fin': 'Amaiera data',
        'mostrar-grafico': 'Grafikoa erakutsi',
        'temperatura': 'Tenperatura',
        'humedad': 'Hezetasuna',
        'temperatura-humedad': 'Tenperatura eta Hezetasuna',
        'grafico-atributo': 'Tenperatura eta Hezetasunaren Historia',
        'fecha': 'Data',
        'no-datos': 'Ez da daturik aurkitu zehaztutako epean',
        'error-datos': 'Errorea datuak lortzean',
        'error-fechas': 'Hasiera data amaiera data baino lehenagokoa izan behar da',
        'seleccionar-todos': 'Mesedez, bete eremu guztiak',
        // Traducciones para pronósticos
        'pronostico-manana': 'Biharko iragarpena',
        'error-pronostico': 'Errorea eguraldiaren iragarpena lortzean',
        'error-api-key': 'Autentifikazio errorea: API gakoa baliogabea',
        'ciudad-no-encontrada': 'Hiria ez da aurkitu',
        'error-api': 'Errorea eguraldi zerbitzuarekin konektatzean',
        'no-datos-disponibles': 'Ez dago daturik eskuragarri',
        'no-pronostico-manana': 'Ez da biharko iragarpenik aurkitu',
        'pronostico-para': 'Iragarpena:',
        'pronostico-no-disponible': 'Iragarpena ez dago eskuragarri momentu honetan',
        'baliza-no-encontrada': 'Baliza ez da aurkitu',
        'formato-invalido': 'Datu formatu baliogabea'
    }
};

let currentLanguage = 'es';

// Función para actualizar las traducciones de elementos dinámicos
function traducirPagina() {
    // Actualizar placeholder del selector de baliza
    const balizaSelector = document.getElementById('baliza-grafico');
    if (balizaSelector && balizaSelector.options.length > 0) {
        balizaSelector.options[0].text = translations[currentLanguage]['seleccionar-baliza-placeholder'];
    }

    // Actualizar textos de última actualización
    const ultimaActualizacionElements = document.querySelectorAll('.ultima-actualizacion');
    ultimaActualizacionElements.forEach(element => {
        const label = element.querySelector('label');
        if (label) {
            label.textContent = translations[currentLanguage]["Última actualización"] + ':';
        }
    });

    // Actualizar todos los elementos con data-translate
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[currentLanguage][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[currentLanguage][key];
            } else {
                element.textContent = translations[currentLanguage][key];
            }
        }
    });
}

// Función para traducir el tiempo
function translateWeather(weather) {
    const weatherLower = weather.toLowerCase();
    for (let key in translations.es) {
        if (translations.es[key].toLowerCase() === weatherLower) {
            return translations[currentLanguage][key];
        }
    }
    return weather;
}

// Función para convertir unidades
function convertUnit(value, unit) {
    if (currentLanguage === 'en') {
        switch(unit) {
            case '°C':
                return Math.round((value * 9/5) + 32); // Celsius a Fahrenheit
            case 'km/h':
                return Math.round(value * 0.621371); // km/h a mph
            case 'mm':
                return Math.round(value * 0.0393701 * 100) / 100; // mm a pulgadas
            default:
                return value;
        }
    }
    return value;
}

function translatePage() {
    document.querySelectorAll("[data-translate]").forEach(element => {
        const key = element.getAttribute("data-translate");
        if (translations[currentLanguage][key]) {
            if (element.tagName === "INPUT" || element.tagName === "TEXTAREA") {
                element.placeholder = translations[currentLanguage][key];
            } else {
                element.textContent = translations[currentLanguage][key];
            }
        }
    });
}

// Exportar las funciones para que estén disponibles en otros archivos
window.translations = translations;
window.currentLanguage = currentLanguage;
window.translateWeather = translateWeather;
window.convertUnit = convertUnit;
window.updateDynamicTranslations = traducirPagina;

document.addEventListener("DOMContentLoaded", () => {
    // Cargar el idioma guardado (si existe)
    const savedLanguage = localStorage.getItem("language");
    if (savedLanguage) {
        currentLanguage = savedLanguage;
        document.getElementById("language-selector").value = currentLanguage;
    }

    // Traducir la página al cargar
    translatePage();
    traducirPagina();

    // Cambiar idioma al seleccionar una opción del selector
    document.getElementById("language-selector").addEventListener("change", (event) => {
        currentLanguage = event.target.value;
        localStorage.setItem("language", currentLanguage);
        translatePage();
        traducirPagina();
        
        // Disparar evento de cambio de idioma
        const languageEvent = new CustomEvent('languageChanged', {
            detail: { language: currentLanguage }
        });
        document.dispatchEvent(languageEvent);
    });
});
